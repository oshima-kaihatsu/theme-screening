<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>デイトレスクリーニング ダッシュボード</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line"></i> デイトレスクリーニング
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" id="nav-dashboard">
                            <i class="fas fa-tachometer-alt"></i> ダッシュボード
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="nav-screening">
                            <i class="fas fa-filter"></i> スクリーニング
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="nav-monitoring">
                            <i class="fas fa-eye"></i> モニタリング
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="nav-positions">
                            <i class="fas fa-wallet"></i> ポジション
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="container-fluid mt-3">
        <!-- ステータスバー -->
        <div class="row mb-3">
            <div class="col-md-3">
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <h5 class="card-title">本日の推奨銘柄</h5>
                        <h2 class="display-4" id="today-picks">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h5 class="card-title">監視中銘柄</h5>
                        <h2 class="display-4" id="monitoring-count">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-info">
                    <div class="card-body">
                        <h5 class="card-title">本日の損益</h5>
                        <h2 class="display-4" id="today-pnl">¥0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-warning">
                    <div class="card-body">
                        <h5 class="card-title">勝率</h5>
                        <h2 class="display-4" id="win-rate">0%</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- タブコンテンツ -->
        <div class="row">
            <!-- ダッシュボードタブ -->
            <div id="dashboard-tab" class="tab-content">
                <div class="col-12">
                    <h3><i class="fas fa-chart-bar"></i> パフォーマンスサマリー</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>損益推移</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="pnl-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>トップパフォーマー</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm" id="top-performers-table">
                                        <thead>
                                            <tr>
                                                <th>銘柄</th>
                                                <th>出現回数</th>
                                                <th>平均スコア</th>
                                                <th>平均出来高比</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- スクリーニングタブ -->
            <div id="screening-tab" class="tab-content" style="display: none;">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3><i class="fas fa-filter"></i> スクリーニング結果</h3>
                        <button class="btn btn-primary" id="run-screening">
                            <i class="fas fa-play"></i> スクリーニング実行
                        </button>
                    </div>

                    <!-- 3000円未満のカテゴリー -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <h5><i class="fas fa-coins"></i> 3,000円未満の推奨銘柄 <span id="under-3000-count" class="badge bg-light text-dark">0</span></h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped" id="under-3000-table">
                                <thead>
                                    <tr>
                                        <th>ランク</th>
                                        <th>銘柄コード</th>
                                        <th>取引所</th>
                                        <th>銘柄名</th>
                                        <th>スコア</th>
                                        <th>現在値</th>
                                        <th>前日比</th>
                                        <th>出来高比</th>
                                        <th>シグナル</th>
                                        <th>アクション</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 3000円～10000円のカテゴリー -->
                    <div class="card mb-3">
                        <div class="card-header bg-info text-white">
                            <h5><i class="fas fa-yen-sign"></i> 3,000円～10,000円の推奨銘柄 <span id="range-3000-10000-count" class="badge bg-light text-dark">0</span></h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped" id="range-3000-10000-table">
                                <thead>
                                    <tr>
                                        <th>ランク</th>
                                        <th>銘柄コード</th>
                                        <th>取引所</th>
                                        <th>銘柄名</th>
                                        <th>スコア</th>
                                        <th>現在値</th>
                                        <th>前日比</th>
                                        <th>出来高比</th>
                                        <th>シグナル</th>
                                        <th>アクション</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 全体のランキング -->
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5><i class="fas fa-trophy"></i> 総合ランキング（全価格帯）</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped" id="screening-table">
                                <thead>
                                    <tr>
                                        <th>ランク</th>
                                        <th>銘柄コード</th>
                                        <th>取引所</th>
                                        <th>銘柄名</th>
                                        <th>スコア</th>
                                        <th>現在値</th>
                                        <th>前日比</th>
                                        <th>出来高比</th>
                                        <th>シグナル</th>
                                        <th>アクション</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- モニタリングタブ -->
            <div id="monitoring-tab" class="tab-content" style="display: none;">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3><i class="fas fa-eye"></i> リアルタイムモニタリング</h3>
                        <div>
                            <button class="btn btn-success" id="start-monitoring">
                                <i class="fas fa-play"></i> 監視開始
                            </button>
                            <button class="btn btn-danger" id="stop-monitoring">
                                <i class="fas fa-stop"></i> 監視停止
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <table class="table table-striped" id="monitoring-table">
                                <thead>
                                    <tr>
                                        <th>銘柄</th>
                                        <th>エントリー</th>
                                        <th>現在値</th>
                                        <th>損益</th>
                                        <th>損益率</th>
                                        <th>損切り</th>
                                        <th>利確</th>
                                        <th>ステータス</th>
                                        <th>アクション</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ポジションタブ -->
            <div id="positions-tab" class="tab-content" style="display: none;">
                <div class="col-12">
                    <h3><i class="fas fa-wallet"></i> ポジション管理</h3>

                    <!-- オープンポジション -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5>オープンポジション</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped" id="open-positions-table">
                                <thead>
                                    <tr>
                                        <th>銘柄</th>
                                        <th>エントリー時刻</th>
                                        <th>エントリー価格</th>
                                        <th>株数</th>
                                        <th>現在損益</th>
                                        <th>損益率</th>
                                        <th>アクション</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- クローズドポジション -->
                    <div class="card">
                        <div class="card-header">
                            <h5>クローズドポジション（直近10件）</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped" id="closed-positions-table">
                                <thead>
                                    <tr>
                                        <th>銘柄</th>
                                        <th>エントリー</th>
                                        <th>エグジット</th>
                                        <th>保有期間</th>
                                        <th>損益</th>
                                        <th>損益率</th>
                                        <th>理由</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 銘柄詳細モーダル -->
    <div class="modal fade" id="stockModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="stockModalLabel">銘柄詳細</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="stock-chart"></div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <h6>テクニカル指標</h6>
                            <table class="table table-sm" id="indicators-table">
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>推奨アクション</h6>
                            <div id="recommendation-panel"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="add-to-monitoring">
                        <i class="fas fa-plus"></i> 監視リストに追加
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
                </div>
            </div>
        </div>
    </div>

    <!-- アラートトースト -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="alertToast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto">アラート</strong>
                <small class="text-muted">今</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="alertMessage"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>